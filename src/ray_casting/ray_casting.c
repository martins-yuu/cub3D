/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ray_casting.c                                      :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: tforster <tfforster@student.42sp.org.br    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2024/07/21 14:38:13 by tforster          #+#    #+#             */
/*   Updated: 2024/08/08 22:03:15 by tforster         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

// #include <stdint.h>
#include <stdio.h>

#include <math.h>
#include <stdint.h>
#include "color/color.h"
#include "ctx/ctx.h"
#include "game/game.h"
#include "graph_lib/graph_func.h"
#include "graph_lib/graph_types.h"
#include "ray_casting/dda.h"
#include "ray_casting/ray_types.h"

int All_Textures_64[]=               //all 32x32 textures
{
 //Checkerboard
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,1,1,1,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,1,1,1,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,

 2,2,2,2,2,2,2,2, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 2,2,2,2,2,2,2,2, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 2,2,2,2,2,2,2,2, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 2,2,2,2,2,2,2,2, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 2,2,2,2,2,2,2,2, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 2,2,2,2,2,2,2,2, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 2,2,2,2,2,2,2,2, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 2,2,2,2,2,2,2,2, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,

 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,

 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,

 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,

 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,

 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,

 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
};


int All_Textures[]=               //all 32x32 textures
{
 //Checkerboard
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,1,1,1,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,1,1,1,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,

 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,

 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,

 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,
};

static void	loop_rays(t_player *plr, float ray_theta_dgr);
static void	draw_2drays(t_player *plr, const t_vec2 ray_dir);
static void	draw_view(t_player *plr, const t_ray ray,
				const float view_theta, const int ray_nb, float ray_theta_dgr);
static int	get_line_height(const float dist, const float view_theta);

void	ray_casting(t_player *plr)
{
	const float	ray_theta_dgr = fix_angle(plr->dgr + plr->fov / 2);

	loop_rays(plr, ray_theta_dgr);
}

static void	loop_rays(t_player *plr, float ray_theta_dgr)
{
	int			ray_nb;
	float		ray_theta_del;
	t_ray		ray;
	const int	total_rays = ctx()->width / plr->pixel;

	ray_theta_del = plr->fov / total_rays;
	ray_nb = 0;
	while (ray_nb < total_rays)
	{
		ray = dda(plr, ray_theta_dgr);
		draw_2drays(plr, ray.dir);
		draw_view(plr, ray, fix_angle((plr->dgr - ray_theta_dgr)), ray_nb, ray_theta_dgr);
		ray_theta_dgr = fix_angle(ray_theta_dgr - ray_theta_del);
		ray_nb++;
	}
	printf(">>>>>>>>>>>>>>>>>>>>>>END LINE\n");

}

static void	draw_2drays(t_player *plr, const t_vec2 ray_dir)
{
	t_mat2			scale;
	t_vec2			n_vec[2];
	t_ivec2			pixel[2];
	t_line			line;
	const t_color	c = color_hex_alpha(RED, A100);

	if (plr->to_draw.rays)
	{
		scale = mat2_scale((t_vec2){map_ctx().min_dim, map_ctx().min_dim, 1});
		n_vec[0] = mat2_vec2_mult(scale, plr->p0);
		n_vec[1] = mat2_vec2_mult(scale, ray_dir);
		pixel[0] = (t_ivec2){(int) n_vec[0].x, (int) n_vec[0].y};
		pixel[1] = (t_ivec2){(int) n_vec[1].x, (int) n_vec[1].y};
		line = (t_line){pixel[0], pixel[1], c, c};
		bresenham(plr->shape, &line);
	}
}

static void	draw_view(t_player *plr, const t_ray ray,
				const float view_theta, const int ray_nb, float ray_theta_dgr)
{
	int			size_texture = 64;
	// int			size_texture = 32;

	t_ivec2		i;
	t_vec2		texture;
	t_vec2		step;
	t_vec2		texture_offset;


	// int		line_h = get_line_height(ray.dist, view_theta);	// line height
	int	line_h;
	line_h = ctx()->height / (ray.dist * cosf(deg_rad(view_theta)));	// Fix fisheye

	// line_h = ctx()->height / ray.dist;	// Fix fisheye

	step.y = (float) size_texture / line_h;
	texture_offset.y = 0;

	if (line_h > ctx()->height)
	{
		texture_offset.y = ((float) line_h - ctx()->height) / 2;
		line_h = ctx()->height;
	}
	int		line_offset = ctx()->height / 2 - (line_h / 2);	// line offset

	texture.y = texture_offset.y * step.y;

	if (ray.wall_type == 1)
	{
		// SOMEHOW MAKE THE tex.x in the borders bigger ans small in the midle
		texture.x = (int)(ray.dir.x * size_texture) % size_texture;
		// texture.x = (int)(ray.dir.x * (size_texture)) % size_texture;
		// printf("RAY_DIR[%.2f] TEXTURE_X[%.2f]\n", ray.dir.x, texture.x);
		if (ray_theta_dgr > 180)
			texture.x = (size_texture - 1) - texture.x;
	}
	else
	{
		texture.x = (int)(ray.dir.y * size_texture) % size_texture;
		if (ray_theta_dgr > 90 && ray_theta_dgr < 270)
			texture.x = (size_texture - 1) - texture.x;
	}


	i.y = 0;
	int j = 780;

	t_color	c = ray.color;
	t_color n_c;
	while (i.y < line_h)
	{
		// if (ray_nb == 0)
		// {
		// 	printf("Y[%d] LINE_H[%d] STEP[%.3f] TEXTURE OFF SET [%.3f]\n", i.y, line_h, step.y, texture_offset.y);
		// };
		float shade = 0;
		if (ray.wall_type)
			shade = 35;

		int k = 1;
		int p_pos = ((int) texture.y * size_texture + (int) texture.x) * k;// + (ray.mt * size_texture * size_texture * k);

		// printf("POS[%d]\n", p_pos);

		// if (All_Textures_64[(int) texture.y * size_texture + (int) (texture.x)] == 0)
		if (All_Textures_64[p_pos] == 0)
			c = color_from_rgba((int) (shade + 0), (int) (shade + 0), (int) (shade + 0), 254);
		// else if (All_Textures_64[(int) texture.y * size_texture + (int) (texture.x)] == 2)
		else if (All_Textures_64[p_pos] == 2)
			c = color_from_rgba((int) (255 - shade), (int) (shade + 0), (int) (shade + 0), 255);
		else
			c = color_from_rgba((int) (255 - shade), (int) (255 - shade), (int) (255 - shade), 255);

		if (i.y == 0)
			printf("RAY_DIR[%.2f] TEXTURE_X[%.2f] POS[%d][%d]\n", ray.dir.x, texture.x, p_pos, c.value);


		n_c = color_from_rgba
		(
			// plr->texture->north->pixels[(int) texture.y * size_texture + (int) texture.x],
			// plr->texture->north->pixels[(int) texture.y * size_texture + (int) texture.x + 1],
			// plr->texture->north->pixels[(int) texture.y * size_texture + (int) texture.x + 2],
			// plr->texture->north->pixels[(int) texture.y * size_texture + (int) texture.x + 3]

			plr->texture->north->pixels[p_pos],
			plr->texture->north->pixels[p_pos + 1],
			plr->texture->north->pixels[p_pos + 2],
			plr->texture->north->pixels[p_pos + 3]
		);
		n_c = c;

		i.x = 0;
		while (i.x < plr->pixel)
		{


			mlx_put_pixel(plr->view, ray_nb * plr->pixel + i.x,
				line_offset + i.y, n_c.value);
			i.x++;
		}
		texture.y += step.y;
		i.y++;
	}

}

static int	get_line_height(const float dist, const float view_theta)
{
	int	line_h;

	line_h = (1 * ctx()->height) / (dist * cosf(deg_rad(view_theta)));
	if (line_h > ctx()->height)
		line_h = ctx()->height;
	return (line_h);
}




/*

RAY_DIR[6.63] TEXTURE_X[40.00] POS[40][-589505281]
RAY_DIR[6.63] TEXTURE_X[40.00] POS[40][-589505281]
RAY_DIR[6.64] TEXTURE_X[40.00] POS[40][-589505281]
RAY_DIR[6.64] TEXTURE_X[41.00] POS[41][-589505281]
RAY_DIR[6.65] TEXTURE_X[41.00] POS[41][-589505281]
RAY_DIR[6.66] TEXTURE_X[42.00] POS[42][-589505281]
RAY_DIR[6.66] TEXTURE_X[42.00] POS[42][-589505281]
RAY_DIR[6.67] TEXTURE_X[42.00] POS[42][-589505281]
RAY_DIR[6.68] TEXTURE_X[43.00] POS[43][-589505281]
RAY_DIR[6.68] TEXTURE_X[43.00] POS[43][-589505281]
RAY_DIR[6.69] TEXTURE_X[44.00] POS[44][-589505281]
RAY_DIR[6.70] TEXTURE_X[44.00] POS[44][-589505281]
RAY_DIR[6.70] TEXTURE_X[44.00] POS[44][-589505281]
RAY_DIR[6.71] TEXTURE_X[45.00] POS[45][-589505281]
RAY_DIR[6.71] TEXTURE_X[45.00] POS[45][-589505281]
RAY_DIR[6.72] TEXTURE_X[46.00] POS[46][-589505281]
RAY_DIR[6.73] TEXTURE_X[46.00] POS[46][-589505281]
RAY_DIR[6.73] TEXTURE_X[46.00] POS[46][-589505281]
RAY_DIR[6.74] TEXTURE_X[47.00] POS[47][-589505281]
RAY_DIR[6.75] TEXTURE_X[47.00] POS[47][-589505281]

19
0,12







RAY_DIR[6.13] TEXTURE_X[8.00] POS[8][-589505281]
RAY_DIR[6.13] TEXTURE_X[8.00] POS[8][-589505281]
RAY_DIR[6.14] TEXTURE_X[8.00] POS[8][-589505281]
RAY_DIR[6.15] TEXTURE_X[9.00] POS[9][-589505281]
RAY_DIR[6.15] TEXTURE_X[9.00] POS[9][-589505281]
RAY_DIR[6.16] TEXTURE_X[10.00] POS[10][-589505281]
RAY_DIR[6.17] TEXTURE_X[10.00] POS[10][-589505281]
RAY_DIR[6.17] TEXTURE_X[10.00] POS[10][-589505281]
RAY_DIR[6.18] TEXTURE_X[11.00] POS[11][-589505281]
RAY_DIR[6.18] TEXTURE_X[11.00] POS[11][-589505281]
RAY_DIR[6.19] TEXTURE_X[12.00] POS[12][-589505281]
RAY_DIR[6.20] TEXTURE_X[12.00] POS[12][-589505281]
RAY_DIR[6.20] TEXTURE_X[13.00] POS[13][-589505281]
RAY_DIR[6.21] TEXTURE_X[13.00] POS[13][-589505281]
RAY_DIR[6.22] TEXTURE_X[13.00] POS[13][-589505281]
RAY_DIR[6.22] TEXTURE_X[14.00] POS[14][-589505281]
RAY_DIR[6.23] TEXTURE_X[14.00] POS[14][-589505281]
RAY_DIR[6.24] TEXTURE_X[15.00] POS[15][-589505281]
RAY_DIR[6.24] TEXTURE_X[15.00] POS[15][-589505281]
RAY_DIR[6.25] TEXTURE_X[15.00] POS[15][-589505281]

19
0,12







RAY_DIR[3.75] TEXTURE_X[48.00] POS[48][589505534]
RAY_DIR[3.76] TEXTURE_X[48.00] POS[48][589505534]
RAY_DIR[3.76] TEXTURE_X[48.00] POS[48][589505534]
RAY_DIR[3.77] TEXTURE_X[49.00] POS[49][589505534]
RAY_DIR[3.77] TEXTURE_X[49.00] POS[49][589505534]
RAY_DIR[3.78] TEXTURE_X[49.00] POS[49][589505534]
RAY_DIR[3.78] TEXTURE_X[50.00] POS[50][589505534]
RAY_DIR[3.79] TEXTURE_X[50.00] POS[50][589505534]
RAY_DIR[3.79] TEXTURE_X[50.00] POS[50][589505534]
RAY_DIR[3.80] TEXTURE_X[51.00] POS[51][589505534]
RAY_DIR[3.80] TEXTURE_X[51.00] POS[51][589505534]
RAY_DIR[3.81] TEXTURE_X[51.00] POS[51][589505534]
RAY_DIR[3.81] TEXTURE_X[52.00] POS[52][589505534]
RAY_DIR[3.82] TEXTURE_X[52.00] POS[52][589505534]
RAY_DIR[3.82] TEXTURE_X[52.00] POS[52][589505534]
RAY_DIR[3.83] TEXTURE_X[52.00] POS[52][589505534]
RAY_DIR[3.83] TEXTURE_X[53.00] POS[53][589505534]
RAY_DIR[3.84] TEXTURE_X[53.00] POS[53][589505534]
RAY_DIR[3.84] TEXTURE_X[53.00] POS[53][589505534]
RAY_DIR[3.85] TEXTURE_X[54.00] POS[54][589505534]
RAY_DIR[3.85] TEXTURE_X[54.00] POS[54][589505534]
RAY_DIR[3.86] TEXTURE_X[54.00] POS[54][589505534]
RAY_DIR[3.86] TEXTURE_X[55.00] POS[55][589505534]
RAY_DIR[3.87] TEXTURE_X[55.00] POS[55][589505534]
RAY_DIR[3.87] TEXTURE_X[55.00] POS[55][589505534]
0,12
24



RAY_DIR[3.88] TEXTURE_X[56.00] POS[56][-589505281]
RAY_DIR[3.88] TEXTURE_X[56.00] POS[56][-589505281]
RAY_DIR[3.89] TEXTURE_X[56.00] POS[56][-589505281]
RAY_DIR[3.89] TEXTURE_X[57.00] POS[57][-589505281]
RAY_DIR[3.90] TEXTURE_X[57.00] POS[57][-589505281]
RAY_DIR[3.90] TEXTURE_X[57.00] POS[57][-589505281]
RAY_DIR[3.91] TEXTURE_X[58.00] POS[58][-589505281]
RAY_DIR[3.91] TEXTURE_X[58.00] POS[58][-589505281]
RAY_DIR[3.92] TEXTURE_X[58.00] POS[58][-589505281]
RAY_DIR[3.92] TEXTURE_X[58.00] POS[58][-589505281]
RAY_DIR[3.93] TEXTURE_X[59.00] POS[59][-589505281]
RAY_DIR[3.93] TEXTURE_X[59.00] POS[59][-589505281]
RAY_DIR[3.94] TEXTURE_X[59.00] POS[59][-589505281]
RAY_DIR[3.94] TEXTURE_X[60.00] POS[60][-589505281]
RAY_DIR[3.95] TEXTURE_X[60.00] POS[60][-589505281]
RAY_DIR[3.95] TEXTURE_X[60.00] POS[60][-589505281]
RAY_DIR[3.96] TEXTURE_X[61.00] POS[61][-589505281]
RAY_DIR[3.96] TEXTURE_X[61.00] POS[61][-589505281]
RAY_DIR[3.97] TEXTURE_X[61.00] POS[61][-589505281]
RAY_DIR[3.97] TEXTURE_X[62.00] POS[62][-589505281]
RAY_DIR[3.98] TEXTURE_X[62.00] POS[62][-589505281]
RAY_DIR[3.98] TEXTURE_X[62.00] POS[62][-589505281]
RAY_DIR[3.99] TEXTURE_X[63.00] POS[63][-589505281]
RAY_DIR[3.99] TEXTURE_X[63.00] POS[63][-589505281]
RAY_DIR[4.00] TEXTURE_X[63.00] POS[63][-589505281]
0,12
24












 */
