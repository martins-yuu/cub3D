/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   mini_map.c                                              :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: tforster <tfforster@student.42sp.org.br    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2024/07/15 15:49:47 by tforster          #+#    #+#             */
/*   Updated: 2024/07/16 17:01:40 by tforster         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "color/color.h"
#include "ctx/ctx.h"
#include "graph_lib/graph_func.h"
#include "game/game.h"

// #include "vector/bresenham.h"

// static void	draw_minimap(t_map *mini_map);
static void	draw_cube(t_map *mini_map, int x, int y, t_color c);

void	init_map(t_map *mini_map)
{
	int	g_x;
	int	g_y;

	g_x = 8;
	g_y = 8;
	static int grid[8 * 8] =
	{
		1, 1, 1, 1, 1, 1, 1, 1,
		1, 0, 1, 0, 0, 0, 0, 1,
		1, 0, 1, 0, 0, 0, 0, 1,
		1, 0, 1, 0, 0, 0, 0, 1,
		1, 0, 0, 0,78, 0, 0, 1,
		1, 0, 0, 0, 0, 1, 0, 1,
		1, 0, 0, 0, 0, 0, 0, 1,
		1, 1, 1, 1, 1, 1, 1, 1,
	};

	// g_x = 30;
	// g_y = 8;
	// static int grid[30 * 8] =
	// {
	// 	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
	// 	1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
	// 	1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
	// 	1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1,
	// 	1, 0, 0, 0,78, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1,
	// 	1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1,
	// 	1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
	// 	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
	// };

	// g_x = 8;
	// g_y = 48;
	// static int grid[8 * 48] =
	// {
	// 	1, 1, 1, 1, 1, 1, 1, 1,		// 0
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 1
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 2
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 3
	// 	1, 0, 0, 0,78, 0, 0, 1,		// 4
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 5
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 6
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 7
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 8
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 9
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 10
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 11
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 12
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 13
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 14
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 15
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 16
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 17
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 18
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 19
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 20
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 21
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 22
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 23
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 24
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 25
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 26
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 27
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 28
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 29
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 30
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 31
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 32
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 33
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 34
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 35
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 36
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 37
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 38
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 39
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 40
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 41
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 42
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 43
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 44
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 45
	// 	1, 0, 0, 0, 0, 0, 0, 1,		// 46
	// 	1, 1, 1, 1, 1, 1, 1, 1,		// 47
	// };


	mini_map->grid = grid;
	mini_map->grid_size.x = g_x;
	mini_map->grid_size.y = g_y;
	// mini_map->cube_s = 64;
	mini_map->player_pos0.x = 4;
	mini_map->player_pos0.y = 4;
	mini_map->img = ctx_img_new(g_x * CUBE_S, g_y * CUBE_S);
	// mini_map->img = ctx_img_new(MINI_MAP_S, MINI_MAP_S);
	ctx_img_display(mini_map->img, 0, 0);
	mini_map->img->instances->z = 1;
	// draw_minimap(mini_map);
}

 void	draw_minimap(t_map *mini_map)
{
	uint32_t	i;
	t_color		wall_c;
	t_color		space_c;

	int	x, y;
	i = 0;

	// wall_c = color_hex_alpha(S_WHT);
	wall_c = color_hex_alpha(S_WHT, A050);
	space_c = color_hex_alpha(S_BLK, A050);
	x = 0;
	y = 0;
	while (y < mini_map->grid_size.y)
	{
		x = 0;
		while (x < mini_map->grid_size.x)
		{
			if (mini_map->grid[y * mini_map->grid_size.x + x] == 1)
				draw_cube(mini_map, x ,y, wall_c);
			else
				draw_cube(mini_map, x ,y, space_c);
			x++;
		}
		y++;
	}
}

static void	draw_cube(t_map *mini_map, int x, int y, t_color c)
{
	t_color	c1;
	int	p;
	// int	size = mini_map->cube_s;
	int	size = CUBE_S;
	int	nb_pixels = size * size;

	p = 0;
	while (p < nb_pixels)
	{
		if (p % size == 0 || p % size == (size -1) || p / size == 0 || p / size >= (size - 1))
			c1 = color_hex_alpha(D_GREY, A100);
		else
			c1 = c;
		mlx_put_pixel(mini_map->img, (p % 64) + x * size, (p / 64) + y * size, c1.value);
		p++;
	}
}
